<html>
    <head>
        <title>
            Globals In React Native
        </title>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/tomorrow-night-eighties.min.css">
    </head>
    <body>
        <div>
            <a href="/">Home</a>
        </div>
        <div>
            <p>Recently I ran into a problem in React Native.</p>
<p>I wanted to be able to have more granular control of my build besides React Native's <code>__DEV__</code>.</p>
<p>Our QA people need to have a few tools at their disposal to run the APP vs our live and test servers.
I don't want to make them download the project on Github and run it. That would force them onto a mac for iOS builds.
I don't want to ship the app with <code>__DEV__</code> on. It would be quite complex to have them connect to some dev package server to run the app
A third option was needed. There should be a <code>__QA__</code> flag. This way I can release the APP in without <code>__DEV__</code> but keep some QA features I want.
The naive way would be to have something like a <code>globals.js</code> file that you include and edit the file for different releases. eg.</p>
<pre class="hljs"><code><span class="hljs-comment">//for production release</span>
GLOBAL.__QA__ = <span class="hljs-literal">false</span>;
GLOBAL.__PROD__ = <span class="hljs-literal">true</span>;
</code></pre>
<p>But the one thing I don't want to do is <strong>EVER</strong> edit code manually for different releases. It should all be handled on the command line with <code>make</code></p>
<p>I wish react-native had some easy way to define globals from the command line. like the C preproccessor defines eg.</p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> SOME_FLAG</span>
...
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre>
<p>and then you can switch your flags on and off from command line with <code>gcc file.cpp -D SOME_FLAG=1</code>
A a side note I make use of defines in my <code>AppDelegate.m</code> so I don't have to comment out code for production or release.</p>
<pre class="hljs"><code><span class="hljs-meta">#if defined(DEBUG)</span>
  jsCodeLocation = [<span class="hljs-built_in">NSURL</span> URLWithString:<span class="hljs-string">@"http://127.0.0.1:8081/index.ios.bundle?platform=ios&amp;dev=true"</span>];
<span class="hljs-meta">#else</span>
  <span class="hljs-comment">/**
   * OPTION 2
   * Load from pre-bundled file on disk. The static bundle is automatically
   * generated by "Bundle React Native code and images" build step.
   */</span>

  jsCodeLocation = [[<span class="hljs-built_in">NSBundle</span> mainBundle] URLForResource:<span class="hljs-string">@"main"</span> withExtension:<span class="hljs-string">@"jsbundle"</span>];
<span class="hljs-meta">#endif</span>
</code></pre>
<p>So the problem is:</p>
<p>I want to have flags for the code without manually having to edit files for releases.</p>
<p>I came up with a solution I am okay with for right now.
I start with a <code>globals.js</code> file and include that in my <code>index.ios.js</code> and <code>index.android.js</code> files.
Then I made files for each of the different enviroments I wanted to support. <code>globals_dev.js</code> <code>globals_qa.js</code> <code>globals_prod.js</code>
all with the 3 flags I want in correctly set eg for <code>globals_qa.js</code></p>
<pre class="hljs"><code>GLOBAL.__QA__ = <span class="hljs-literal">true</span>;
GLOBAL.__PROD__ = <span class="hljs-literal">false</span>;
</code></pre>
<p>Then when I go to create a build for anything I concat the correct <code>globals_x.js</code> into <code>globals.js</code> to set all the flags to the values I wanted.
It looks something like this.</p>
<pre class="hljs"><code>cat globals_x.js &gt; globals.js
</code></pre>
<p>So my make instruction for qa might look something like this. (remember I want QA to be a production build with 1 flag set)</p>
<p>(I also made custom builder and uploader scripts for iOS but ill save that for a later post)</p>
<pre><code class="language-make">QA:
  cat globals_dev.js &gt; globals.js
  cd android &amp;&amp; ./gradlew assembleRelease
  ./scripts/build_ios.sh
</code></pre>
<p>BOOM now with this you can setup any enviroment you want with as many flags as you want to support!</p>

        </div>
    </body>
</html>
